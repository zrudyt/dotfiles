NetBSD post-install
===================

INSERT SYSTEM SPECIFICS HERE
----------------------------

    #!/bin/sh
    set -o nounset
    MYHOST="starbase"
    MYDOMAIN="home"
    MYGATE="192.168.2.1"
    MYUSER="rudy"

Make a non-root user
--------------------

    useradd -m -s /usr/pkg/bin/zsh -G wheel $MYUSER    # make non-root user
    # Don't forget to run 'passwd $MYUSER' after creating so they can log in
    # You can add group 'wheel' to an existing user with
    # 'user mod -G wheel $MYUSER' or by editing /etc/group by hand and
    # adding ',$MYUSER' to wheel line

System stuff
------------

### /boot.cfg

    [ -e /boot.cfg ] && mv -f /boot.cfg /etc/boot.cfg.save
    cat <<- EOF > /boot.cfg
    	banner= _   _      _   ____ ____  ____       __  _ _____  ___   __        ___   _____ 
    	banner=| \ | | ___| |_| __ ) ___||  _ \     / / (_)___ / ( _ ) / /_      / _ \ |___ / 
    	banner=|  \| |/ _ \ __|  _ \___ \| | | |   / /  | | |_ \ / _ \| '_ \    | (_) |  |_ \ 
    	banner=| |\  |  __/ |_| |_) |__) | |_| |  / /   | |___) | (_) | (_) |    \__, | ___) |
    	banner=|_| \_|\___|\__|____/____/|____/  /_/    |_|____/ \___/ \___/       /_(_)____/ 
    	banner=                                                                               
    	banner=Welcome to NetBSD!
    	banner=	
    	menu=Boot normally:rndseed /var/db/entropy-file;boot
    	menu=Boot single user:rndseed /var/db/entropy-file;boot -s
    	menu=Drop to boot prompt:prompt
    	default=1
    	timeout=5
    	clear=1
    EOF

### /etc/motd

    [ -e /etc/motd ] && mv -f /etc/motd /etc/motd.save
    cat <<- EOF > /etc/motd
    	NetBSD 9.3 (GENERIC) #0: Thu Aug  4 15:30:37 UTC 2022
    	 _   _      _   ____ ____  ____       __  _ _____  ___   __        ___   _____ 
    	| \ | | ___| |_| __ ) ___||  _ \     / / (_)___ / ( _ ) / /_      / _ \ |___ / 
    	|  \| |/ _ \ __|  _ \___ \| | | |   / /  | | |_ \ / _ \| '_ \    | (_) |  |_ \ 
    	| |\  |  __/ |_| |_) |__) | |_| |  / /   | |___) | (_) | (_) |    \__, | ___) |
    	|_| \_|\___|\__|____/____/|____/  /_/    |_|____/ \___/ \___/       /_(_)____/ 
    	                                                                               
    	NetBSD 9.3 (GENERIC) #0: Thu Aug  4 15:30:37 UTC 2022
    	
    	Welcome to NetBSD!
    	
    EOF

Host and Network configuration
------------------------------

### /etc/myname

    [ -z "$MYHOST" ] && MYHOST="localhost"
    [ -e /etc/myname ] && mv -f /etc/myname /etc/myname.save
    echo "${MYHOST}.${MYDOMAIN}" > /etc/myname

### /etc/mygate

    [ -e /etc/mygate ] && mv -f /etc/mygate /etc/mygate.save
    [ -n "$MYGATE" ] && echo "$MYDATE" > /etc/mygate

### /etc/resolv.conf

    [ -e /etc/resolv.conf ] && mv -f /etc/resolv.conf /etc/resolv.conf.save
    [ -n "$MYGATE" ] && cat <<- EOF > /etc/resolv.conf
    	# Generated by resolvconf
    	domain $MYDOMAIN
    	nameserver $MYGATE
    	nameserver 207.164.234.129
    EOF

### /etc/hosts

    [ -e /etc/hosts ] && mv -f /etc/hosts /etc/hosts.save
    [ -n "$MYGATE" ] && cat <<- EOF > /etc/hosts
    	#	$NetBSD: hosts,v 1.9 2013/11/24 07:20:01 dholland Exp $
    	#
    	# Host name database.
    	#
    	# This file contains addresses and aliases for local hosts whose names
    	# need to be resolvable during system boot; typically this includes only
    	# the address and FQDN for this machine's hostname.
    	#
    	# By default this file is consulted before DNS, so adding additional
    	# material here that then becomes out of date can lead to confusion.
    	# See nsswitch.conf(5).
    	#
    	::1			localhost localhost.$MYDOMAIN
    	127.0.0.1		localhost localhost.$MYDOMAIN
    	#
    	# RFC 1918 specifies that these networks are "internal":
    	# 10.0.0.0        -   10.255.255.255  (10/8 prefix)
    	# 172.16.0.0      -   172.31.255.255  (172.16/12 prefix)
    	# 192.168.0.0     -   192.168.255.255 (192.168/16 prefix)
    	#
    	192.168.2.1	router router.$MYDOMAIN
    	192.168.2.126	starbase starbase.$MYDOMAIN
    	192.168.2.127	zguide zguide.$MYDOMAIN
    EOF

### /etc/wpa_supplicant.conf

    [ -e /etc/wpa_supplicant.conf ] && mv -f /etc/wpa_supplicant.conf /etc/wpa_supplicant.conf.save
    [ -n "$MYGATE" ] && cat <<- EOF > /etc/wpa_supplicant.conf
    	# $NetBSD: wpa_supplicant.conf,v 1.1 2019/01/12 16:51:54 roy Exp $
    	#
    	# Allow wpa_cli(8) to configure wpa_supplicant
    	ctrl_interface=/var/run/wpa_supplicant
    	ctrl_interface_group=wheel
    	update_config=1
    	#
    	#
    	# Added by NetBSD sysinst
    	#
    	network={
    		ssid="NCC-1701"
    		psk="RudyTaraschi--5071Fraser"
    		scan_ssid=1
    	}
    EOF


Package installations
---------------------

    pkg_install pkgin                                 # package manager
    pkgin -y update                                   # update database
    pkgin -y install zsh dash bash colorls nnn tmux   # shells and tools
    pkgin -y install wget curl lynx w3m               # network tools
    pkgin -y install neovim                           # a real $EDITOR
    pkgin -y install doas                             # doas
    echo "permit nopass keepenv $MYUSER as root" > /usr/pkg/etc/doas.conf

    # Install Python and Perl first to satisfy git requirements. This way,
    # Python and Perl will be marked non auto-removable and won't get removed
    # if we uninstall git.  To figure out what specific packages are needed,
    #  run 'pkgin install git' and say NO to installing git  Look at the
    # Python package name that git is looking for.  At the time of this
    # writing, it's python39.  Install python and perl, then install git

    pkgin -y install python39 py39-pip perl           # Python and Perl
    pkgin -y install git                              # ... then install git
    git config --global http.sslVerify false          # get rid of unable to
                                                      # get issuer certificate
    pkgin -y install ffmpeg atomicparsley lame        # CLI/TUI multi-media
    pkgin -y install firefox cwm                      # X apps
    pkgin -y install meld ratpoison evilwm            # Maybe these X apps too

    # Maybe install these CLI/TUI apps (some may not be available on NetBSD)
    pkgin -y install newsboat mutt slrn openvpn ubuntufonts tldr fortune figlet

    # Maybe install these stupid and useless CLI/TUI apps as well
    pkgin -y install cmatrix cowsay lolcat bullshit asciiquarium aafire tty-clock holleywood bb


User stuff (assumes logged in as $MYUSER)
-----------------------------------------

### setup XDG directories

    mkdir -p "$HOME/.config"
    mkdir -p "$HOME/.cache"
    mkdir -p "$HOME/.local/bin"
    mkdir -p "$HOME/.local/share"
    mkdir -p "$HOME/.local/state"

### setup zsh

    chsh -s /usr/pkg/bin/zsh "$MYUSER"
    mkdir -p "$HOME/.config/zsh"

    [ -e "$HOME/.zshenv" ] && mv -f "$HOME/.zshenv" "$HOME/.zshenv.save"
    cat <<- EOF > "$HOME/.zshenv"
    	# ~/.zshenv
    	
    	# XDG paths
    	
        export XDG_CONFIG_HOME="$HOME/.config"
        export XDG_CACHE_HOME="$HOME/.cache"
        export XDG_BIN_HOME="$HOME/.local/bin"
        export XDG_DATA_HOME="$HOME/.local/share"
        export XDG_STATE_HOME="$HOME/.local/state"
        export XDG_DESKTOP_DIR="$HOME/Desktop"
        export XDG_DOCUMENTS_DIR="$HOME/Documents"
        export XDG_DOWNLOAD_DIR="$HOME/Downloads"

    	export ZDOTDIR="$XDG_CONFIG_HOME/zsh"
    EOF

### tarballs

- dwm/dmenu/st from suckless.org
- pkg-config - used to build suckless.org apps
